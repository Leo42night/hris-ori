<?php
error_reporting(0);
//ini_set('display_errors', 1);
//error_reporting(E_ALL);
ini_set('memory_limit', '-1');

include('koneksi.php');
include('../fungsi.php');
require '../vendor/autoload.php';
use PhpOffice\PhpSpreadsheet\Spreadsheet;
use PhpOffice\PhpSpreadsheet\Style\Border;
use PhpOffice\PhpSpreadsheet\Writer\Xlsx;

function TanggalIndo3($date){
    $BulanIndo = array("Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember");
      
    $tahun = substr($date, 0, 4);
    $bulan = substr($date, 5, 2);
    $tgl   = substr($date, 8, 2);
      
    $result = $BulanIndo[(int)$bulan-1] . " ". $tahun;	
    return($result);
}

$blth2 = $_REQUEST['blth'];
//$blth2 = "2023-03";

$tempdir = "temp/"; 
if (!file_exists($tempdir))
    mkdir($tempdir);

//PLNT    
$spreadsheet = new Spreadsheet();
$spreadsheet->setActiveSheetIndex(0);
$sheet = $spreadsheet->getActiveSheet();
$sheet->setTitle('Data Payroll');

$sheet->getStyle('A1:BD1')->getFill()->setFillType(\PhpOffice\PhpSpreadsheet\Style\Fill::FILL_SOLID)->getStartColor()->setARGB('FFb5b1b1');
$sheet->getStyle('A1:BD1')->getAlignment()->setWrapText(true);
$sheet->getStyle("A1:BD1")->applyFromArray([
    "alignment" => [
        "vertical" => \PhpOffice\PhpSpreadsheet\Style\Alignment::VERTICAL_TOP,
        "horizontal" => \PhpOffice\PhpSpreadsheet\Style\Alignment::HORIZONTAL_CENTER
    ],
]);


$sheet->getColumnDimension('A')->setWidth(5);
$sheet->getColumnDimension('B')->setWidth(15);
$sheet->getColumnDimension('C')->setWidth(25);
$sheet->getColumnDimension('D')->setWidth(15);
$sheet->getColumnDimension('E')->setWidth(15);
$sheet->getColumnDimension('F')->setWidth(15);
$sheet->getColumnDimension('G')->setWidth(15);
$sheet->getColumnDimension('H')->setWidth(15);
$sheet->getColumnDimension('I')->setWidth(15);
$sheet->getColumnDimension('J')->setWidth(15);
$sheet->getColumnDimension('K')->setWidth(15);
$sheet->getColumnDimension('L')->setWidth(15);
$sheet->getColumnDimension('M')->setWidth(15);
$sheet->getColumnDimension('N')->setWidth(15);
$sheet->getColumnDimension('O')->setWidth(15);
$sheet->getColumnDimension('P')->setWidth(15);
$sheet->getColumnDimension('Q')->setWidth(15);
$sheet->getColumnDimension('R')->setWidth(15);
$sheet->getColumnDimension('S')->setWidth(15);
$sheet->getColumnDimension('T')->setWidth(15);
$sheet->getColumnDimension('U')->setWidth(15);
$sheet->getColumnDimension('V')->setWidth(15);
$sheet->getColumnDimension('W')->setWidth(15);
$sheet->getColumnDimension('X')->setWidth(15);
$sheet->getColumnDimension('Y')->setWidth(15);
$sheet->getColumnDimension('Z')->setWidth(15);
$sheet->getColumnDimension('AA')->setWidth(15);
$sheet->getColumnDimension('AB')->setWidth(15);
$sheet->getColumnDimension('AC')->setWidth(15);
$sheet->getColumnDimension('AD')->setWidth(15);
$sheet->getColumnDimension('AE')->setWidth(15);
$sheet->getColumnDimension('AF')->setWidth(15);
$sheet->getColumnDimension('AG')->setWidth(15);
$sheet->getColumnDimension('AH')->setWidth(15);
$sheet->getColumnDimension('AI')->setWidth(15);
$sheet->getColumnDimension('AJ')->setWidth(15);
$sheet->getColumnDimension('AK')->setWidth(15);
$sheet->getColumnDimension('AL')->setWidth(15);
$sheet->getColumnDimension('AM')->setWidth(15);
$sheet->getColumnDimension('AN')->setWidth(15);
$sheet->getColumnDimension('AO')->setWidth(15);
$sheet->getColumnDimension('AP')->setWidth(15);
$sheet->getColumnDimension('AQ')->setWidth(15);
$sheet->getColumnDimension('AR')->setWidth(15);
$sheet->getColumnDimension('AS')->setWidth(15);
$sheet->getColumnDimension('AT')->setWidth(15);
$sheet->getColumnDimension('AU')->setWidth(15);
$sheet->getColumnDimension('AV')->setWidth(15);
$sheet->getColumnDimension('AW')->setWidth(15);
$sheet->getColumnDimension('AX')->setWidth(15);
$sheet->getColumnDimension('AY')->setWidth(15);
$sheet->getColumnDimension('AZ')->setWidth(15);
$sheet->getColumnDimension('BA')->setWidth(15);
$sheet->getColumnDimension('BB')->setWidth(15);
$sheet->getColumnDimension('BC')->setWidth(15);
$sheet->getColumnDimension('BD')->setWidth(15);


$alignment_center = \PhpOffice\PhpSpreadsheet\Style\Alignment::HORIZONTAL_CENTER;
$alignment_center2 = \PhpOffice\PhpSpreadsheet\Style\Alignment::VERTICAL_CENTER;

$sheet->setCellValue('A1', 'No');
$sheet->setCellValue('B1', 'NIP');
$sheet->setCellValue('C1', 'Nama');
$sheet->setCellValue('D1', 'Gaji Dasar');
$sheet->setCellValue('E1', 'Honorarium');
$sheet->setCellValue('F1', 'Honorer');
$sheet->setCellValue('G1', 'Tarif Grade (P1)');
$sheet->setCellValue('H1', 'P2-1A');
$sheet->setCellValue('I1', 'P2-1B');
$sheet->setCellValue('J1', 'Tunj.Lokasi');
$sheet->setCellValue('K1', 'Tunj.Perumahan');
$sheet->setCellValue('L1', 'Tunj.Transportasi');
$sheet->setCellValue('M1', 'Bantuan Pulsa');
$sheet->setCellValue('N1', 'Tunjangan Kompetensi');
$sheet->setCellValue('O1', 'Lembur');
$sheet->setCellValue('P1', 'Uraian Tunjangan1');
$sheet->setCellValue('Q1', 'Tunjangan1');
$sheet->setCellValue('R1', 'Uraian Tunjangan2');
$sheet->setCellValue('S1', 'Tunjangan2');
$sheet->setCellValue('T1', 'Uraian Tunjangan3');
$sheet->setCellValue('U1', 'Tunjangan3');
$sheet->setCellValue('V1', 'Uraian Tunjangan4');
$sheet->setCellValue('W1', 'Tunjangan4');
$sheet->setCellValue('X1', 'Total Pendapatan');
$sheet->setCellValue('Y1', 'DPLK Persero');
$sheet->setCellValue('Z1', 'DPLK Simponi Perusahaan');
$sheet->setCellValue('AA1', 'BPJS JP');
$sheet->setCellValue('AB1', 'BPJS JKM');
$sheet->setCellValue('AC1', 'BPJS JKK');
$sheet->setCellValue('AD1', 'BPJS JHT');
$sheet->setCellValue('AE1', 'BPJS Kes');
$sheet->setCellValue('AF1', 'Benefit');
$sheet->setCellValue('AG1', 'Pendapatan+Benefit');
$sheet->setCellValue('AH1', 'Pot.Koperasi');
$sheet->setCellValue('AI1', 'Pot.Bazis');
$sheet->setCellValue('AJ1', 'Pot DPLK Simponi');
$sheet->setCellValue('AK1', 'Pot DPLK Pribadi');
$sheet->setCellValue('AL1', 'COP Kendaraan');
$sheet->setCellValue('AM1', 'Iuran Peserta');
$sheet->setCellValue('AN1', 'BRPR');
$sheet->setCellValue('AO1', 'Sewa Mess');
$sheet->setCellValue('AP1', 'Pot.Qurban');
$sheet->setCellValue('AQ1', 'Pot.Arisan');
$sheet->setCellValue('AR1', 'Pot.BPJS JP');
$sheet->setCellValue('AS1', 'Pot.BPJS JHT');
$sheet->setCellValue('AT1', 'Pot.BPJS Kes');
$sheet->setCellValue('AU1', 'Uraian Potongan1');
$sheet->setCellValue('AV1', 'Potongan1');
$sheet->setCellValue('AW1', 'Uraian Potongan2');
$sheet->setCellValue('AX1', 'Potongan2');
$sheet->setCellValue('AY1', 'Uraian Potongan3');
$sheet->setCellValue('AZ1', 'Potongan3');
$sheet->setCellValue('BA1', 'Uraian Potongan4');
$sheet->setCellValue('BB1', 'Potongan4');
$sheet->setCellValue('BC1', 'Total Potongan');
$sheet->setCellValue('BD1', 'Dibayarkan');

$gaji_dasar2 = 0;
$honorarium2 = 0;
$honorer2 = 0;
$tarif_grade2 = 0;
$tunjangan_posisi2 = 0;
$p21b2 = 0;
$tunjangan_kemahalan2 = 0;
$tunjangan_perumahan2 = 0;
$tunjangan_transportasi2 = 0;
$bantuan_pulsa2 = 0;
$tunjangan_kompetensi2 = 0;
$dplk_persero2 = 0;
$dplk_simponi_pr2 = 0;
$lembur2 = 0;
$tunjangan12 = 0;
$tunjangan22 = 0;
$tunjangan32 = 0;
$tunjangan42 = 0;
$bpjs_tk_pp2 = 0;
$bpjs_tk_kp2 = 0;
$bpjs_tk_kkp2 = 0;
$bpjs_tk_htp2 = 0;
$bpjs_tk_jhtk2 = 0;
$bpjs_tk_pk2 = 0;
$bpjs_kes_pp2 = 0;
$bpjs_kes_pk2 = 0;
$total_pendapatan2 = 0;
$bpjs_pr2 = 0;
$benefit2 = 0;
$pendapatan_benefit2 = 0;
$pot_koperasi2 = 0;
$pot_bazis2 = 0;
$dplk_simponi2 = 0;
$pot_dplk_pribadi2 = 0;
$cop_kendaraan2 = 0;
$iuran_peserta2 = 0;
$brpr2 = 0;
$sewa_mess2 = 0;
$qurban2 = 0;
$arisan2 = 0;
$potongan12 = 0;
$potongan22 = 0;
$potongan32 = 0;
$potongan42 = 0;
$total_potongan2 = 0;
$pph212 = 0;
$upah_bersih2 = 0;

$i = 2;
$no = 1;
// $rs = mysqli_query($koneksi,"select a.*,b.nama,b.jabatan,b.jenis,b.nama_bank,b.no_rekening,b.nama_rekening from gaji a left join data_pegawai b on a.nip=b.nip where a.blth='$blth2' and b.jenis<>'ORGANIK' and b.jenis<>'TUGAS KARYA' and b.jenis<>'TUGAS KERJA' order by a.id asc");
$rs = mysqli_query($koneksi,"select a.*,b.nama,b.jabatan,b.jenis,b.nama_bank,b.no_rekening,b.nama_rekening from gaji a left join data_pegawai b on a.nip=b.nip where a.blth='$blth2' order by a.id asc");
while ($hasil = mysqli_fetch_array($rs)){
    $id = stripslashes ($hasil['id']);
    $blth = stripslashes ($hasil['blth']);
    $nip = stripslashes ($hasil['nip']);
    $nama_lengkap = stripslashes ($hasil['nama']);
    $npwp = stripslashes ($hasil['npwp']);
    $kpp = stripslashes ($hasil['kpp']);
    $jenis = stripslashes ($hasil['jenis']);
    $gaji_dasar = floatval(stripslashes ($hasil['gaji_dasar']));
    $honorarium = floatval(stripslashes ($hasil['honorarium']));
    $honorer = floatval(stripslashes ($hasil['honorer']));
    $tarif_grade = floatval(stripslashes ($hasil['tarif_grade']));
    $tunjangan_posisi = floatval(stripslashes ($hasil['tunjangan_posisi']));
    $p21b = floatval(stripslashes ($hasil['p21b']));
    $tunjangan_kemahalan = floatval(stripslashes ($hasil['tunjangan_kemahalan']));
    $tunjangan_perumahan = floatval(stripslashes ($hasil['tunjangan_perumahan']));
    $tunjangan_transportasi = floatval(stripslashes ($hasil['tunjangan_transportasi']));
    $bantuan_pulsa = floatval(stripslashes ($hasil['bantuan_pulsa']));
    $tunjangan_kompetensi = floatval(stripslashes ($hasil['tunjangan_kompetensi']));
    $dplk_persero = floatval(stripslashes ($hasil['dplk_persero']));
    $dplk_simponi_pr = floatval(stripslashes ($hasil['dplk_simponi_pr']));
    $lembur = floatval(stripslashes ($hasil['lembur']));
    $nama_tunjangan1 = stripslashes ($hasil['nama_tunjangan1']);
    $tunjangan1 = floatval(stripslashes ($hasil['tunjangan1']));
    $nama_tunjangan2 = stripslashes ($hasil['nama_tunjangan2']);
    $tunjangan2 = floatval(stripslashes ($hasil['tunjangan2']));
    $nama_tunjangan3 = stripslashes ($hasil['nama_tunjangan3']);
    $tunjangan3 = floatval(stripslashes ($hasil['tunjangan3']));
    $nama_tunjangan4 = stripslashes ($hasil['nama_tunjangan4']);
    $tunjangan4 = floatval(stripslashes ($hasil['tunjangan4']));
    $bpjs_tk_pp = floatval(stripslashes ($hasil['bpjs_tk_pp']));
    $bpjs_tk_kp = floatval(stripslashes ($hasil['bpjs_tk_kp']));
    $bpjs_tk_kkp = floatval(stripslashes ($hasil['bpjs_tk_kkp']));
    $bpjs_tk_htp = floatval(stripslashes ($hasil['bpjs_tk_htp']));
    $bpjs_tk_jhtk = floatval(stripslashes ($hasil['bpjs_tk_jhtk']));
    $bpjs_tk_pk = floatval(stripslashes ($hasil['bpjs_tk_pk']));
    $bpjs_kes_pp = floatval(stripslashes ($hasil['bpjs_kes_pp']));
    $bpjs_kes_pk = floatval(stripslashes ($hasil['bpjs_kes_pk']));
    $total_pendapatan = floatval(stripslashes ($hasil['total_pendapatan']));
    $bpjs_pr = floatval(stripslashes ($hasil['bpjs_pr']));
    $benefit = floatval(stripslashes ($hasil['benefit']));        
    $pendapatan_benefit = floatval(stripslashes ($hasil['pendapatan_benefit']));        
    $pot_koperasi = floatval(stripslashes ($hasil['pot_koperasi']));        
    $pot_bazis = floatval(stripslashes ($hasil['pot_bazis']));        
    $dplk_simponi = floatval(stripslashes ($hasil['dplk_simponi']));        
    $pot_dplk_pribadi = floatval(stripslashes ($hasil['pot_dplk_pribadi']));        
    $cop_kendaraan = floatval(stripslashes ($hasil['cop_kendaraan']));
    $iuran_peserta = floatval(stripslashes ($hasil['iuran_peserta']));
    $brpr = floatval(stripslashes ($hasil['brpr']));
    $sewa_mess = floatval(stripslashes ($hasil['sewa_mess']));
    $qurban = floatval(stripslashes ($hasil['qurban']));
    $arisan = floatval(stripslashes ($hasil['arisan']));
    $nama_potongan1 = stripslashes ($hasil['nama_potongan1']);
    $potongan1 = floatval(stripslashes ($hasil['potongan1']));
    $nama_potongan2 = stripslashes ($hasil['nama_potongan2']);
    $potongan2 = floatval(stripslashes ($hasil['potongan2']));
    $nama_potongan3 = stripslashes ($hasil['nama_potongan3']);
    $potongan3 = floatval(stripslashes ($hasil['potongan3']));
    $nama_potongan4 = stripslashes ($hasil['nama_potongan4']);
    $potongan4 = floatval(stripslashes ($hasil['potongan4']));
    $total_potongan = floatval(stripslashes ($hasil['total_potongan']));
    $pph21 = floatval(stripslashes ($hasil['pph21']));
    $upah_bersih = floatval(stripslashes ($hasil['upah_bersih']));
    $bank_payroll = stripslashes ($hasil['nama_bank']);
    $no_rek_payroll = stripslashes ($hasil['no_rekening']);
    $an_payroll = stripslashes ($hasil['nama_rekening']);
    
    $gaji_dasar2 = $gaji_dasar2+$gaji_dasar;
    $honorarium2 = $honorarium2+$honorarium;
    $honorer2 = $honorer2+$honorer;
    $tarif_grade2 = $tarif_grade2+$tarif_grade;
    $tunjangan_posisi2 = $tunjangan_posisi2+$tunjangan_posisi;
    $p21b2 = $p21b2+$p21b;
    $tunjangan_kemahalan2 = $tunjangan_kemahalan2+$tunjangan_kemahalan;
    $tunjangan_perumahan2 = $tunjangan_perumahan2+$tunjangan_perumahan;
    $tunjangan_transportasi2 = $tunjangan_transportasi2+$tunjangan_transportasi;
    $bantuan_pulsa2 = $bantuan_pulsa2+$bantuan_pulsa;
    $tunjangan_kompetensi2 = $tunjangan_kompetensi2+$tunjangan_kompetensi;
    $dplk_persero2 = $dplk_persero2+$dplk_persero;
    $dplk_simponi_pr2 = $dplk_simponi_pr2+$dplk_simponi_pr;
    $lembur2 = $lembur2+$lembur;
    $tunjangan12 = $tunjangan12+$tunjangan1;
    $tunjangan22 = $tunjangan22+$tunjangan2;
    $tunjangan32 = $tunjangan32+$tunjangan3;
    $tunjangan42 = $tunjangan42+$tunjangan4;
    $bpjs_tk_pp2 = $bpjs_tk_pp2+$bpjs_tk_pp;
    $bpjs_tk_kp2 = $bpjs_tk_kp2+$bpjs_tk_kp;
    $bpjs_tk_kkp2 = $bpjs_tk_kkp2+$bpjs_tk_kkp;
    $bpjs_tk_htp2 = $bpjs_tk_htp2+$bpjs_tk_htp;
    $bpjs_tk_jhtk2 = $bpjs_tk_jhtk2+$bpjs_tk_jhtk;
    $bpjs_tk_pk2 = $bpjs_tk_pk2+$bpjs_tk_pk;
    $bpjs_kes_pp2 = $bpjs_kes_pp2+$bpjs_kes_pp;
    $bpjs_kes_pk2 = $bpjs_kes_pk2+$bpjs_kes_pk;
    $total_pendapatan2 = $total_pendapatan2+$total_pendapatan;
    $bpjs_pr2 = $bpjs_pr2+$bpjs_pr;
    $benefit2 = $benefit2+$benefit;
    $pendapatan_benefit2 = $pendapatan_benefit2+$pendapatan_benefit;
    $pot_koperasi2 = $pot_koperasi2+$pot_koperasi;
    $pot_bazis2 = $pot_bazis2+$pot_bazis;
    $dplk_simponi2 = $dplk_simponi2+$dplk_simponi;
    $pot_dplk_pribadi2 = $pot_dplk_pribadi2+$pot_dplk_pribadi;
    $cop_kendaraan2 = $cop_kendaraan2+$cop_kendaraan;
    $iuran_peserta2 = $iuran_peserta2+$iuran_peserta;
    $brpr2 = $brpr2+$brpr;
    $sewa_mess2 = $sewa_mess2+$sewa_mess;
    $qurban2 = $qurban2+$qurban;
    $arisan2 = $arisan2+$arisan;
    $potongan12 = $potongan12+$potongan1;
    $potongan22 = $potongan22+$potongan2;
    $potongan32 = $potongan32+$potongan3;
    $potongan42 = $potongan42+$potongan4;
    $total_potongan2 = $total_potongan2+$total_potongan;
    $pph212 = $pph212+$pph21;
    $upah_bersih2 = $upah_bersih2+$upah_bersih;

    $spreadsheet->getActiveSheet()->getStyle('D'.$i.':BC'.$i)->getNumberFormat()->setFormatCode('#,##0');
    $sheet->getStyle('A'.$i.':BC'.$i)->applyFromArray([
        "alignment" => [
            "vertical" => \PhpOffice\PhpSpreadsheet\Style\Alignment::VERTICAL_TOP
        ],
    ]);

    $sheet->setCellValue('A'.$i, $no);
    $sheet->setCellValue('B'.$i, $nip);
    $sheet->setCellValue('C'.$i, $nama_lengkap);
    $sheet->setCellValue('D'.$i, $gaji_dasar);
    $sheet->setCellValue('E'.$i, $honorarium);
    $sheet->setCellValue('F'.$i, $honorer);
    $sheet->setCellValue('G'.$i, $tarif_grade);
    $sheet->setCellValue('H'.$i, $tunjangan_posisi);
    $sheet->setCellValue('I'.$i, $p21b);
    $sheet->setCellValue('J'.$i, $tunjangan_kemahalan);
    $sheet->setCellValue('K'.$i, $tunjangan_perumahan);
    $sheet->setCellValue('L'.$i, $tunjangan_transportasi);
    $sheet->setCellValue('M'.$i, $bantuan_pulsa);
    $sheet->setCellValue('N'.$i, $tunjangan_kompetensi);
    $sheet->setCellValue('O'.$i, $lembur);
    $sheet->setCellValue('P'.$i, $nama_tunjangan1);
    $sheet->setCellValue('Q'.$i, $tunjangan1);
    $sheet->setCellValue('R'.$i, $nama_tunjangan2);
    $sheet->setCellValue('S'.$i, $tunjangan2);
    $sheet->setCellValue('T'.$i, $nama_tunjangan3);
    $sheet->setCellValue('U'.$i, $tunjangan3);
    $sheet->setCellValue('V'.$i, $nama_tunjangan4);
    $sheet->setCellValue('W'.$i, $tunjangan4);
    $sheet->setCellValue('X'.$i, $total_pendapatan);
    $sheet->setCellValue('Y'.$i, $dplk_persero);
    $sheet->setCellValue('Z'.$i, $dplk_simponi_pr);
    $sheet->setCellValue('AA'.$i, $bpjs_tk_pp);
    $sheet->setCellValue('AB'.$i, $bpjs_tk_kp);
    $sheet->setCellValue('AC'.$i, $bpjs_tk_kkp);
    $sheet->setCellValue('AD'.$i, $bpjs_tk_htp);
    $sheet->setCellValue('AE'.$i, $bpjs_kes_pp);
    $sheet->setCellValue('AF'.$i, $benefit);
    $sheet->setCellValue('AG'.$i, $pendapatan_benefit);
    $sheet->setCellValue('AH'.$i, $pot_koperasi);
    $sheet->setCellValue('AI'.$i, $pot_bazis);
    $sheet->setCellValue('AJ'.$i, $dplk_simponi);
    $sheet->setCellValue('AK'.$i, $pot_dplk_pribadi);
    $sheet->setCellValue('AL'.$i, $cop_kendaraan);
    $sheet->setCellValue('AM'.$i, $iuran_peserta);
    $sheet->setCellValue('AN'.$i, $brpr);
    $sheet->setCellValue('AO'.$i, $sewa_mess);
    $sheet->setCellValue('AP'.$i, $qurban);
    $sheet->setCellValue('AQ'.$i, $arisan);
    $sheet->setCellValue('AR'.$i, $bpjs_tk_pk);
    $sheet->setCellValue('AS'.$i, $bpjs_tk_jhtk);
    $sheet->setCellValue('AT'.$i, $bpjs_kes_pk);
    $sheet->setCellValue('AU'.$i, $nama_potongan1);
    $sheet->setCellValue('AV'.$i, $potongan1);
    $sheet->setCellValue('AW'.$i, $nama_potongan2);
    $sheet->setCellValue('AX'.$i, $potongan2);
    $sheet->setCellValue('AY'.$i, $nama_potongan3);
    $sheet->setCellValue('AZ'.$i, $potongan3);
    $sheet->setCellValue('BA'.$i, $nama_potongan4);
    $sheet->setCellValue('BB'.$i, $potongan4);
    $sheet->setCellValue('BC'.$i, $total_potongan);
    $sheet->setCellValue('BD'.$i, $upah_bersih);
    $i++;
    $no = $no+1;
}
$sheet->getStyle('A'.$i.':BD'.$i)->getFill()->setFillType(\PhpOffice\PhpSpreadsheet\Style\Fill::FILL_SOLID)->getStartColor()->setARGB('FFb5b1b1');
$spreadsheet->getActiveSheet()->getStyle('D'.$i.':BD'.$i)->getNumberFormat()->setFormatCode('#,##0');
$sheet->setCellValue('A'.$i, "");
$sheet->setCellValue('B'.$i, "");
$sheet->setCellValue('C'.$i, "TOTAL");
$sheet->setCellValue('D'.$i, $gaji_dasar2);
$sheet->setCellValue('E'.$i, $honorarium2);
$sheet->setCellValue('F'.$i, $honorer2);
$sheet->setCellValue('G'.$i, $tarif_grade2);
$sheet->setCellValue('H'.$i, $tunjangan_posisi2);
$sheet->setCellValue('I'.$i, $p21b2);
$sheet->setCellValue('J'.$i, $tunjangan_kemahalan2);
$sheet->setCellValue('K'.$i, $tunjangan_perumahan2);
$sheet->setCellValue('L'.$i, $tunjangan_transportasi2);
$sheet->setCellValue('M'.$i, $bantuan_pulsa2);
$sheet->setCellValue('N'.$i, $tunjangan_kompetensi2);
$sheet->setCellValue('O'.$i, $lembur2);
$sheet->setCellValue('P'.$i, '');
$sheet->setCellValue('Q'.$i, $tunjangan12);
$sheet->setCellValue('R'.$i, '');
$sheet->setCellValue('S'.$i, $tunjangan22);
$sheet->setCellValue('T'.$i, '');
$sheet->setCellValue('U'.$i, $tunjangan32);
$sheet->setCellValue('V'.$i, '');
$sheet->setCellValue('W'.$i, $tunjangan42);
$sheet->setCellValue('X'.$i, $total_pendapatan2);
$sheet->setCellValue('Y'.$i, $dplk_persero2);
$sheet->setCellValue('Z'.$i, $dplk_simponi_pr2);
$sheet->setCellValue('AA'.$i, $bpjs_tk_pp2);
$sheet->setCellValue('AB'.$i, $bpjs_tk_kp2);
$sheet->setCellValue('AC'.$i, $bpjs_tk_kkp2);
$sheet->setCellValue('AD'.$i, $bpjs_tk_htp2);
$sheet->setCellValue('AE'.$i, $bpjs_kes_pp2);
$sheet->setCellValue('AF'.$i, $benefit2);
$sheet->setCellValue('AG'.$i, $pendapatan_benefit2);
$sheet->setCellValue('AH'.$i, $pot_koperasi2);
$sheet->setCellValue('AI'.$i, $pot_bazis2);
$sheet->setCellValue('AJ'.$i, $dplk_simponi2);
$sheet->setCellValue('AK'.$i, $pot_dplk_pribadi2);
$sheet->setCellValue('AL'.$i, $cop_kendaraan2);
$sheet->setCellValue('AM'.$i, $iuran_peserta2);
$sheet->setCellValue('AN'.$i, $brpr2);
$sheet->setCellValue('AO'.$i, $sewa_mess2);
$sheet->setCellValue('AP'.$i, $qurban2);
$sheet->setCellValue('AQ'.$i, $arisan2);
$sheet->setCellValue('AR'.$i, $bpjs_tk_pk2);
$sheet->setCellValue('AS'.$i, $bpjs_tk_jhtk2);
$sheet->setCellValue('AT'.$i, $bpjs_kes_pk2);
$sheet->setCellValue('AU'.$i, '');
$sheet->setCellValue('AV'.$i, $potongan12);
$sheet->setCellValue('AW'.$i, '');
$sheet->setCellValue('AX'.$i, $potongan22);
$sheet->setCellValue('AY'.$i, '');
$sheet->setCellValue('AZ'.$i, $potongan32);
$sheet->setCellValue('BA'.$i, '');
$sheet->setCellValue('BB'.$i, $potongan42);
$sheet->setCellValue('BC'.$i, $total_potongan2);
$sheet->setCellValue('BD'.$i, $upah_bersih2);

$spreadsheet->setActiveSheetIndex(0);
header('Content-Type: application/vnd.openxmlformats-officedocument.spreadsheetml.sheet');
header('Content-Disposition: attachment; filename="Data Payroll.xlsx"');
header('Cache-Control: max-age=0');
$writer = new Xlsx($spreadsheet);
$writer->save('php://output');
//$writer->save('hello world.xlsx');

?>